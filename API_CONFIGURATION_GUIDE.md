# API 配置指南

## 问题诊断

如果您遇到以下问题：
- ❌ API 返回 401 (Unauthorized) 错误
- ❌ API 返回 429 (Too Many Requests) 错误  
- ❌ 无法生成图片
- ❌ 下载的分镜图是白底，没有生成的图片

这通常是由于 **API 密钥配置不正确** 或 **API 端点配置错误** 导致的。

## 解决方案

### 1. 检查 API 密钥配置

打开应用，点击右上角的 **⚙️ 设置** 按钮：

#### 对于 LLM (脚本生成)：
- **提供商**: 选择 `智谱AI` 或 `OpenAI 兼容`
- **API 密钥**: 输入您的有效 API 密钥
- **模型**: 
  - 智谱: `glm-4` 或 `glm-4-flash`
  - OpenAI: `gpt-4` 或 `gpt-3.5-turbo`
  - 其他: `Qwen/Qwen2.5-7B-Instruct`

#### 对于图片生成：
- **提供商**: 选择 `智谱AI`、`硅基流动` 或 `速创`
- **API 密钥**: 输入您的有效 API 密钥
- **模型**:
  - 智谱: `cogview-4-250304`
  - 硅基流动: `black-forest-labs/FLUX.1-schnell`
  - 速创: `nano-banana`

### 2. 获取 API 密钥

#### 智谱 AI (推荐)
1. 访问 https://open.bigmodel.cn/
2. 注册或登录账户
3. 创建 API 密钥
4. 复制密钥到应用设置

#### 硅基流动
1. 访问 https://cloud.siliconflow.cn/
2. 注册或登录账户
3. 创建 API 密钥
4. 复制密钥到应用设置

#### 速创 (Sucreative)
1. 访问 https://www.wuyinkeji.com/
2. 注册或登录账户
3. 创建 API 密钥
4. 复制密钥到应用设置

### 3. 测试 API 连接

在设置中，点击 **测试连接** 按钮来验证：
- ✅ LLM API 是否可用
- ✅ 图片生成 API 是否可用

### 4. 常见错误及解决方案

| 错误 | 原因 | 解决方案 |
|------|------|--------|
| 401 Unauthorized | API 密钥无效或缺失 | 检查 API 密钥是否正确输入 |
| 429 Too Many Requests | API 速率限制 | 等待几分钟后重试，或升级 API 配额 |
| 500 Internal Error | 服务器错误 | 检查 API 端点配置是否正确 |
| 无法生成图片 | 图片 API 配置错误 | 检查图片生成 API 密钥和模型 |

### 5. 脚本分配问题

如果脚本框内的内容不对应，请确保：

1. **Visual Prompt (EN)** - 英文视觉提示词（用于生图）
2. **画面描述 (中文)** - 中文视觉描述（参考用）
3. **Video Prompt (EN)** - 英文视频提示词（用于视频生成）
4. **视频提示词 (中文)** - 中文视频提示词（用于视频生成）

这些字段应该由 LLM 自动填充。如果为空，说明 LLM API 调用失败。

### 6. 调试步骤

1. 打开浏览器开发者工具 (F12)
2. 切换到 **Console** 标签
3. 查看错误日志，找到 API 错误信息
4. 根据错误信息调整配置

## 推荐配置

### 最稳定的配置 (推荐)
```
LLM: 智谱 AI (glm-4)
图片: 智谱 AI (cogview-4-250304)
```

### 成本最低的配置
```
LLM: 硅基流动 (Qwen/Qwen2.5-7B-Instruct)
图片: 硅基流动 (black-forest-labs/FLUX.1-schnell)
```

### 速度最快的配置
```
LLM: 速创 (gemini-3-pro)
图片: 速创 (nano-banana)
```

## 需要帮助？

如果问题仍未解决，请：
1. 检查 API 密钥是否有效
2. 确认 API 账户有足够的配额
3. 尝试不同的 API 提供商
4. 查看浏览器控制台的详细错误信息
