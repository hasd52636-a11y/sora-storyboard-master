# 结构化脚本处理增强

## 更新内容

### 1. 增强的编号检测 (`isStructuredScript`)

现在支持以下编号格式：

#### 英文编号
- `1. 内容` - 数字编号
- `a. 内容` - 字母编号
- `(1) 内容` - 括号数字
- `(a) 内容` - 括号字母
- `- 内容` / `* 内容` / `+ 内容` - 项目符号
- `1: 内容` - 时间戳或序号
- `Scene 1 内容` - 场景编号
- `Shot 1 内容` - 镜头编号

#### 中文编号（新增）
- `第1幕 内容` / `第一幕 内容` - 幕编号
- `第1场 内容` / `第一场 内容` - 场编号
- `第1镜 内容` / `第一镜 内容` - 镜编号
- `第1景 内容` / `第一景 内容` - 景编号
- `1、内容` / `一、内容` - 中文序号
- `[第1幕] 内容` / `[1场] 内容` - 方括号编号

### 2. 改进的脚本拆分 (`splitStructuredScript`)

- 自动识别编号行并去掉编号部分
- 支持多行内容（跨行的分镜描述会自动合并）
- 保留原始内容作为分镜描述
- 自动生成视觉提示词（visualPrompt）

## 使用示例

### 示例1：中文编号脚本
```
第1幕 宇航员在太空站中醒来
发现自己是唯一的幸存者

第2幕 他开始检查设备
试图找到回家的方向

第3幕 发现一条神秘的信息
揭开灾难的真相
```

### 示例2：混合编号脚本
```
1. 主角出现在荒漠中
   环顾四周，迷茫的表情

2. 远处传来声音
   主角转身查看

Scene 3 发现一个古老的遗迹
   走近观察
```

### 示例3：项目符号脚本
```
- 开场：黎明时分，主角醒来
- 冲突：发现周围的异常
- 转折：找到关键线索
- 高潮：真相大白
- 结局：新的开始
```

## 工作流程

1. **用户输入脚本** → OptimizedSetup.tsx
2. **检测是否结构化** → `isStructuredScript()`
   - 如果是结构化脚本 + 未启用AI优化 → 进入本地处理
   - 否则 → 调用LLM API
3. **拆分脚本** → `splitStructuredScript()`
   - 识别编号行
   - 提取内容
   - 生成分镜
4. **生成分镜** → 返回分镜数组

## 优势

✅ **支持多种编号格式** - 用户可以用习惯的方式编号
✅ **快速处理** - 无需调用API，本地处理
✅ **保留原意** - 直接使用用户输入的内容
✅ **中英文混合** - 完全支持中文编号
✅ **灵活扩展** - 易于添加新的编号格式

## 部署信息

- **部署时间**: 2025-12-16
- **部署URL**: https://sora-storyboard-master-adka8g1oy-hanjiangs-projects-bee54024.vercel.app
- **修改文件**: services/geminiService.ts
