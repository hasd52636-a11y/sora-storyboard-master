# 部署前测试验证方案

## 1. 本地环境测试

### 1.1 基础功能测试

1. **启动开发服务器**
   ```bash
   npm run dev
   ```
   - 验证服务器是否正常启动
   - 检查控制台是否有错误信息

2. **AI创意优化功能测试**
   - 勾选"AI创意优化"复选框
   - 输入简单脚本（如："桃花潭水深千尺"）
   - 点击生成，验证是否正常生成分镜和图片
   - 取消勾选"AI创意优化"复选框
   - 输入结构化脚本（如："1. 桃花潭水深千尺\n2. 不及汪伦送我情"）
   - 点击生成，验证是否直接拆分脚本为生成分镜

3. **图片生成测试**
   - 使用不同的视觉风格进行测试
   - 验证生成的图片是否符合所选风格
   - 检查控制台是否有图片加载错误

### 1.2 结构化脚本测试

测试以下结构化脚本格式：

```
1. 场景：桃花潭边
   镜头：全景
   内容：李白与汪伦在桃花潭边话别

2. 场景：桃花潭边
   镜头：特写
   内容：李白望着汪伦远去的背影

3. 场景：船上
   镜头：中景
   内容：李白在船上写下诗句
```

```
- 早晨，阳光洒在桃花潭上
- 李白和汪伦在潭边饮酒话别
- 汪伦挥手告别，李白乘船离去
```

```
Scene 1: 桃花潭边
Shot 1: 全景 - 两人在潭边话别
Shot 2: 特写 - 汪伦的笑容

Scene 2: 船上
Shot 1: 中景 - 李白独自饮酒
Shot 2: 远景 - 桃花潭逐渐远去
```

## 2. 构建验证

1. **执行构建命令**
   ```bash
   npm run build
   ```
   - 验证构建是否成功完成
   - 检查构建输出目录（dist）是否正确生成

2. **预览生产版本**
   ```bash
   npm run preview
   ```
   - 验证预览服务器是否正常启动
   - 重复本地测试的所有功能验证

## 3. 部署前检查清单

### 3.1 代码质量检查
- [ ] 确保没有未解决的语法错误
- [ ] 确保没有未使用的变量或导入
- [ ] 确保所有API调用都有适当的错误处理

### 3.2 配置检查
- [ ] 验证API密钥配置是否正确
- [ ] 检查生产环境的API端点是否正确
- [ ] 确保代理配置在生产环境中被正确忽略

### 3.3 性能检查
- [ ] 确保图片加载不会导致页面卡顿
- [ ] 检查API调用的响应时间
- [ ] 验证分镜生成的效率

## 4. 部署后验证

### 4.1 基础功能验证
- [ ] 网站是否正常加载
- [ ] 所有页面是否可以正常访问
- [ ] 控制台是否有错误信息

### 4.2 核心功能验证
- [ ] AI创意优化功能是否正常工作
- [ ] 图片生成功能是否正常
- [ ] 结构化脚本是否被正确识别和处理
- [ ] 不同视觉风格是否正常应用

### 4.3 边缘情况测试
- [ ] 空脚本输入
- [ ] 超长脚本输入
- [ ] 特殊字符脚本
- [ ] 网络不稳定情况下的表现

## 5. 回滚计划

如果部署后出现问题：

1. **立即回滚**到之前的稳定版本
2. **记录问题**：详细描述出现的问题和错误日志
3. **分析原因**：确定问题的根本原因
4. **修复问题**：在本地环境修复后重新测试
5. **重新部署**：确保修复后的版本通过所有测试

## 6. 常见问题排查

### 6.1 图片加载失败
- 检查API密钥是否有效
- 检查网络连接是否正常
- 查看浏览器控制台的错误信息
- 验证API端点是否正确

### 6.2 AI创意优化功能不生效
- 检查"useAIoptimization"参数是否正确传递
- 验证结构化脚本检测逻辑是否正常工作
- 查看控制台的调试日志（仅开发环境）

### 6.3 分镜生成错误
- 检查脚本格式是否符合要求
- 验证API调用是否成功
- 查看LLM返回的原始数据

## 7. 测试工具和资源

- **浏览器开发者工具**：用于调试和查看错误信息
- **Postman**：用于测试API调用
- **Vercel Dashboard**：用于监控部署状态和日志

---

**测试完成后，请记录测试结果和发现的问题，确保所有问题都得到解决后再进行部署。**